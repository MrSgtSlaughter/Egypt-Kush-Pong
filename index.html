<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kush vs Egypt - Pong</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #fff;
        }

        .container {
            width: 90%;
            max-width: 1000px;
        }

        /* Title Screen */
        #titleScreen {
            background: linear-gradient(135deg, #d4af37 0%, #c9a961 100%);
            color: #1a1a2e;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        #titleScreen h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        #titleScreen .subtitle {
            font-size: 1.2em;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        #titleScreen .historical-context {
            background: rgba(26, 26, 46, 0.8);
            color: #d4af37;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            font-size: 0.95em;
            line-height: 1.6;
        }

        #titleScreen .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: left;
            display: inline-block;
            font-size: 0.9em;
        }

        #titleScreen .instructions h3 {
            margin-bottom: 10px;
            margin-top: 10px;
        }

        #titleScreen .instructions h3:first-child {
            margin-top: 0;
        }

        .form-group {
            margin: 20px 0;
        }

        .form-group input {
            padding: 12px 20px;
            font-size: 1.1em;
            border: none;
            border-radius: 5px;
            width: 100%;
            max-width: 300px;
            background: rgba(255, 255, 255, 0.2);
            color: #1a1a2e;
            border: 2px solid #1a1a2e;
        }

        .form-group input::placeholder {
            color: rgba(26, 26, 46, 0.6);
        }

        .form-group input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.3);
        }

        .btn {
            padding: 12px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn-start {
            background: #1a1a2e;
            color: #d4af37;
            margin-top: 20px;
        }

        .btn-start:hover {
            background: #16213e;
            transform: scale(1.05);
        }

        .btn-start:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .status-text {
            margin-top: 20px;
            font-size: 1em;
            color: #1a1a2e;
            min-height: 30px;
        }

        /* Game Screen */
        #gameScreen {
            display: none;
            background: rgba(26, 26, 46, 0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .game-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .game-header h2 {
            font-size: 1.8em;
            margin-bottom: 10px;
            color: #d4af37;
        }

        .historical-banner {
            background: rgba(212, 175, 55, 0.2);
            border: 2px solid #d4af37;
            color: #d4af37;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .scoreboard {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 5px;
        }

        .player-info {
            text-align: center;
            flex: 1;
        }

        .player-label {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #d4af37;
        }

        .player-name {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .score-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #00ff00;
        }

        .divider {
            text-align: center;
            flex: 0 0 auto;
            font-size: 2em;
            color: #d4af37;
            margin: 0 20px;
        }

        canvas {
            display: block;
            background: #0a0a0a;
            border: 3px solid #d4af37;
            margin: 20px auto;
            border-radius: 5px;
            width: 100%;
            max-width: 800px;
            height: auto;
        }

        .game-info {
            text-align: center;
            font-size: 0.95em;
            color: #aaa;
            margin-top: 15px;
        }

        #modeScreen {
            background: linear-gradient(135deg, #d4af37 0%, #c9a961 100%);
            color: #1a1a2e;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        #modeScreen h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .mode-btn {
            flex: 1;
            min-width: 200px;
            padding: 30px;
            background: #1a1a2e;
            color: #d4af37;
            border: 2px solid #1a1a2e;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .mode-btn:hover {
            background: #16213e;
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .mode-button-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        @media (max-width: 600px) {
            #titleScreen h1 {
                font-size: 1.8em;
            }

            #titleScreen .subtitle {
                font-size: 1em;
            }

            #titleScreen .historical-context {
                font-size: 0.85em;
            }

            .scoreboard {
                flex-wrap: wrap;
            }

            .divider {
                flex-basis: 100%;
                margin: 10px 0;
            }

            .score-display {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Mode Selection Screen -->
        <div id="modeScreen">
            <h1>‚öîÔ∏è Kush vs Egypt ‚öîÔ∏è</h1>
            <p style="font-size: 1.2em; margin-bottom: 30px; opacity: 0.9;">Choose Your Challenge</p>
            
            <div class="mode-button-container">
                <button id="singleplayerBtn" class="mode-btn">
                    <div style="font-size: 2em; margin-bottom: 10px;">ü§ñ</div>
                    <div>Single Player</div>
                    <div style="font-size: 0.8em; margin-top: 10px; opacity: 0.8;">Face the AI</div>
                </button>
                <button id="multiplayerBtn" class="mode-btn">
                    <div style="font-size: 2em; margin-bottom: 10px;">üë•</div>
                    <div>Multiplayer</div>
                    <div style="font-size: 0.8em; margin-top: 10px; opacity: 0.8;">Play with a Friend</div>
                </button>
            </div>
        </div>

        <!-- Title Screen -->
        <div id="titleScreen" style="display: none;">
            <h1>‚öîÔ∏è Kush vs Egypt ‚öîÔ∏è</h1>
            <p class="subtitle">A Pong Game About Ancient Rivalry</p>
            
            <div class="historical-context">
                <strong>Historical Context:</strong> For centuries, the kingdoms of Kush and Egypt competed for control of the Nile Valley. Their relationship was complex‚Äîsometimes rivals, sometimes allies‚Äîbut always influential to each other's survival and growth.
            </div>

            <div class="form-group">
                <input type="text" id="playerName" placeholder="Enter your name" maxlength="20">
            </div>

            <div class="instructions">
                <h3>How to Play:</h3>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>Your Paddle (Kush):</strong> W and S keys to move up and down</li>
                    <li><strong>AI Opponent (Egypt):</strong> Computer controls the right paddle</li>
                    <li>Score points by defending your side and hitting the ball back</li>
                    <li>Try to beat the AI and set a high score!</li>
                </ul>
            </div>

            <button class="btn btn-start" id="startBtn" disabled>Start Game</button>
            <div class="status-text" id="statusText"></div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen">
            <div class="game-header">
                <h2>‚öîÔ∏è Kush vs Egypt ‚öîÔ∏è</h2>
                <div class="historical-banner">
                    Test your Pong skills against the AI! The ancient kingdoms will judge your prowess.
                </div>
            </div>

            <div class="scoreboard">
                <div class="player-info">
                    <div class="player-label">üèúÔ∏è KUSH</div>
                    <div class="player-name" id="playerDisplayName">Player</div>
                    <div class="score-display" id="leftScore">0</div>
                </div>
                <div class="divider">VS</div>
                <div class="player-info">
                    <div class="player-label" id="rightPlayerLabel">üèõÔ∏è EGYPT (AI)</div>
                    <div class="player-name" id="rightPlayerName">Computer</div>
                    <div class="score-display" id="rightScore">0</div>
                </div>
            </div>

            <canvas id="gameCanvas" width="800" height="400"></canvas>

            <div class="game-info" id="gameInfo">
                Use W/S to move your paddle ‚Ä¢ Try to beat the AI!
            </div>
        </div>
    </div>

    <script>
        // ===== GAME STATE =====
        const gameState = {
            playerName: '',
            leftScore: 0,
            rightScore: 0,
            gameStarted: false,
            gameMode: null, // 'single' or 'multi'
            gameStartTime: null,
            elapsedSeconds: 0,
            isPaused: false,
            pauseStartTime: null,
            lastScorer: null,
        };

        // ===== AI OPPONENT =====
        const ai = {
            difficulty: 0.42, // Slightly raised from 0.35
            reactionTime: 0,
            targetY: 200,
            
            update(ballX, ballY, paddleY) {
                this.reactionTime--;
                
                if (this.reactionTime <= 0) {
                    if (ballX > 400) {
                        this.targetY = ballY;
                    }
                    this.reactionTime = Math.random() * 15 + 10; // Slower reaction
                }

                const speed = pong.paddles.right.speed;
                const paddleCenter = paddleY + pong.paddles.right.height / 2;
                const distance = this.targetY - paddleCenter;

                if (Math.abs(distance) > speed * this.difficulty) {
                    pong.paddles.right.vy = distance > 0 ? speed : -speed;
                } else {
                    pong.paddles.right.vy = (distance / 20) * speed;
                }
            }
        };

        // ===== AUDIO SYSTEM =====
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSoundFrequency(frequency, duration, type = 'sine') {
            try {
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const now = audioContext.currentTime;
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                osc.type = type;
                osc.frequency.value = frequency;
                
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + duration);
                
                osc.start(now);
                osc.stop(now + duration);
            } catch(e) {
                console.log('Audio error:', e);
            }
        }

        function playPaddleSound() {
            playSoundFrequency(800, 0.05);
        }

        function playCrowdSound() {
            try {
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const now = audioContext.currentTime;
                const duration = 0.8;
                
                const baseFrequencies = [180, 200, 220, 240];
                
                baseFrequencies.forEach((baseFreq, index) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    
                    osc.type = 'square';
                    osc.frequency.value = baseFreq + (Math.random() * 20);
                    
                    const startDelay = index * 0.05;
                    gain.gain.setValueAtTime(0, now + startDelay);
                    gain.gain.linearRampToValueAtTime(0.15, now + startDelay + 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + startDelay + duration);
                    
                    osc.start(now + startDelay);
                    osc.stop(now + startDelay + duration);
                });
                
                const excitementFreqs = [600, 700, 800];
                excitementFreqs.forEach((freq) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    
                    osc.type = 'sine';
                    osc.frequency.value = freq + (Math.random() * 50);
                    
                    const delay = 0.2 + Math.random() * 0.1;
                    gain.gain.setValueAtTime(0, now + delay);
                    gain.gain.linearRampToValueAtTime(0.08, now + delay + 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + delay + 0.4);
                    
                    osc.start(now + delay);
                    osc.stop(now + delay + 0.4);
                });
            } catch(e) {
                console.log('Crowd sound error:', e);
            }
        }

        function playStartSound() {
            playSoundFrequency(400, 0.15, 'square');
            setTimeout(() => playSoundFrequency(600, 0.15, 'square'), 150);
            setTimeout(() => playSoundFrequency(800, 0.15, 'square'), 300);
        }

        // ===== PONG GAME ENGINE =====
        const pong = {
            canvas: document.getElementById('gameCanvas'),
            ctx: null,
            width: 800,
            height: 400,
            ballSpeed: 3,
            ballSpeedMax: 6,

            ball: {
                x: 400,
                y: 200,
                radius: 6,
                vx: 5,
                vy: 3,
            },

            scoreRegistered: false,

            paddles: {
                left: { x: 20, y: 175, width: 15, height: 50, vy: 0, speed: 6 },
                right: { x: 765, y: 175, width: 15, height: 50, vy: 0, speed: 6 }
            },

            init() {
                this.ctx = this.canvas.getContext('2d');
                this.canvas.width = this.width;
                this.canvas.height = this.height;
                this.resetBall();
            },

            resetBall() {
                this.ball.x = this.width / 2;
                this.ball.y = this.height / 2;
                this.ball.vx = (Math.random() > 0.5 ? 1 : -1) * this.ballSpeed;
                this.ball.vy = (Math.random() - 0.5) * this.ballSpeed;
                this.scoreRegistered = false;
                gameState.gameStartTime = Date.now();
            },

            update() {
                this.ball.x += this.ball.vx;
                this.ball.y += this.ball.vy;

                if (this.ball.y - this.ball.radius < 0 || this.ball.y + this.ball.radius > this.height) {
                    this.ball.vy *= -1;
                    this.ball.y = Math.max(this.ball.radius, Math.min(this.height - this.ball.radius, this.ball.y));
                }

                this.checkPaddleCollision('left');
                this.checkPaddleCollision('right');

                if (this.ball.x - this.ball.radius < 0) {
                    if (!this.scoreRegistered) {
                        gameState.rightScore++;
                        gameState.lastScorer = 'right';
                        gameState.isPaused = true;
                        gameState.pauseStartTime = Date.now();
                        playCrowdSound();
                        this.scoreRegistered = true;
                    }
                } else if (this.ball.x + this.ball.radius > this.width) {
                    if (!this.scoreRegistered) {
                        gameState.leftScore++;
                        gameState.lastScorer = 'left';
                        gameState.isPaused = true;
                        gameState.pauseStartTime = Date.now();
                        playCrowdSound();
                        this.scoreRegistered = true;
                    }
                }

                this.updatePaddle('left');
                this.updatePaddle('right');
            },

            checkPaddleCollision(side) {
                const paddle = this.paddles[side];
                const ballRadius = this.ball.radius;

                if (side === 'left') {
                    if (this.ball.x - ballRadius < paddle.x + paddle.width &&
                        this.ball.y > paddle.y &&
                        this.ball.y < paddle.y + paddle.height) {
                        this.ball.vx = Math.abs(this.ball.vx);
                        this.ball.x = paddle.x + paddle.width + ballRadius;
                        this.ball.vy += paddle.vy * 0.2;
                        playPaddleSound();
                    }
                } else {
                    if (this.ball.x + ballRadius > paddle.x &&
                        this.ball.y > paddle.y &&
                        this.ball.y < paddle.y + paddle.height) {
                        this.ball.vx = -Math.abs(this.ball.vx);
                        this.ball.x = paddle.x - ballRadius;
                        this.ball.vy += paddle.vy * 0.2;
                        playPaddleSound();
                    }
                }

                const speed = Math.sqrt(this.ball.vx ** 2 + this.ball.vy ** 2);
                if (speed > this.ballSpeedMax) {
                    this.ball.vx = (this.ball.vx / speed) * this.ballSpeedMax;
                    this.ball.vy = (this.ball.vy / speed) * this.ballSpeedMax;
                }
            },

            updatePaddle(side) {
                const paddle = this.paddles[side];
                paddle.y += paddle.vy;
                paddle.y = Math.max(0, Math.min(this.height - paddle.height, paddle.y));
            },

            draw() {
                this.ctx.fillStyle = '#0a0a0a';
                this.ctx.fillRect(0, 0, this.width, this.height);

                this.drawNileRiver();
                this.drawPyramids();
                this.drawElephants();
                this.drawHieroglyphics();

                this.ctx.strokeStyle = 'rgba(212, 175, 55, 0.3)';
                this.ctx.setLineDash([10, 10]);
                this.ctx.beginPath();
                this.ctx.moveTo(this.width / 2, 0);
                this.ctx.lineTo(this.width / 2, this.height);
                this.ctx.stroke();
                this.ctx.setLineDash([]);

                this.ctx.fillStyle = '#d4af37';
                this.ctx.fillRect(this.paddles.left.x, this.paddles.left.y, this.paddles.left.width, this.paddles.left.height);
                this.ctx.fillRect(this.paddles.right.x, this.paddles.right.y, this.paddles.right.width, this.paddles.right.height);

                this.ctx.fillStyle = '#00ff00';
                this.ctx.beginPath();
                this.ctx.arc(this.ball.x, this.ball.y, this.ball.radius, 0, Math.PI * 2);
                this.ctx.fill();
            },

            drawNileRiver() {
                this.ctx.fillStyle = 'rgba(100, 180, 255, 0.15)';
                this.ctx.beginPath();
                const riverY = this.height * 0.75;
                const riverHeight = 40;
                
                this.ctx.moveTo(0, riverY);
                for (let x = 0; x <= this.width; x += 10) {
                    const wave = Math.sin(x * 0.01) * 5;
                    this.ctx.lineTo(x, riverY + wave);
                }
                this.ctx.lineTo(this.width, riverY + riverHeight);
                this.ctx.lineTo(0, riverY + riverHeight);
                this.ctx.closePath();
                this.ctx.fill();
                
                this.ctx.strokeStyle = 'rgba(100, 180, 255, 0.4)';
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                this.ctx.moveTo(0, riverY);
                for (let x = 0; x <= this.width; x += 10) {
                    const wave = Math.sin(x * 0.01) * 5;
                    this.ctx.lineTo(x, riverY + wave);
                }
                this.ctx.stroke();
            },

            drawPyramids() {
                this.drawPyramid(100, 120, 60, 'rgba(212, 175, 55, 0.25)');
                this.drawPyramid(150, 140, 40, 'rgba(212, 175, 55, 0.2)');
                
                this.drawPyramid(this.width - 100, 120, 60, 'rgba(212, 175, 55, 0.25)');
                this.drawPyramid(this.width - 150, 140, 40, 'rgba(212, 175, 55, 0.2)');
            },

            drawPyramid(x, y, size, color) {
                this.ctx.fillStyle = color;
                this.ctx.beginPath();
                this.ctx.moveTo(x, y);
                this.ctx.lineTo(x - size, y + size);
                this.ctx.lineTo(x + size, y + size);
                this.ctx.closePath();
                this.ctx.fill();
                
                this.ctx.strokeStyle = 'rgba(212, 175, 55, 0.4)';
                this.ctx.lineWidth = 1;
                this.ctx.stroke();
            },

            drawElephants() {
                this.drawElephant(80, 250, 1, 'rgba(150, 120, 100, 0.3)');
                this.drawElephant(this.width - 80, 250, -1, 'rgba(150, 120, 100, 0.3)');
            },

            drawElephant(x, y, scale, color) {
                this.ctx.fillStyle = color;
                
                this.ctx.beginPath();
                this.ctx.ellipse(x, y, 20, 25, 0, 0, Math.PI * 2);
                this.ctx.fill();
                
                this.ctx.beginPath();
                this.ctx.arc(x + (15 * scale), y - 15, 12, 0, Math.PI * 2);
                this.ctx.fill();
                
                this.ctx.strokeStyle = color;
                this.ctx.lineWidth = 4;
                this.ctx.beginPath();
                this.ctx.moveTo(x + (10 * scale), y + 10);
                this.ctx.quadraticCurveTo(x + (5 * scale), y + 30, x + (8 * scale), y + 45);
                this.ctx.stroke();
                
                this.ctx.fillStyle = color;
                this.ctx.beginPath();
                this.ctx.ellipse(x - (5 * scale), y - 5, 10, 15, 0.3 * scale, 0, Math.PI * 2);
                this.ctx.fill();
            },

            drawHieroglyphics() {
                const hieroglyphs = ['‚óØ', '‚¨ü', '‚óé', '‚ñ≤', '‚óÜ'];
                
                this.ctx.fillStyle = 'rgba(212, 175, 55, 0.25)';
                this.ctx.font = 'bold 16px Arial';
                this.ctx.textAlign = 'center';
                for (let i = 0; i < 3; i++) {
                    this.ctx.fillText(hieroglyphs[i % hieroglyphs.length], 30 + i * 25, 30);
                }
                
                for (let i = 0; i < 3; i++) {
                    this.ctx.fillText(hieroglyphs[(i + 1) % hieroglyphs.length], this.width - 30 - i * 25, 30);
                }
                
                for (let i = 0; i < 4; i++) {
                    this.ctx.fillText(hieroglyphs[(i + 2) % hieroglyphs.length], 25 + i * 30, this.height - 60);
                }
                
                for (let i = 0; i < 4; i++) {
                    this.ctx.fillText(hieroglyphs[(i + 3) % hieroglyphs.length], this.width - 25 - i * 30, this.height - 60);
                }

                this.ctx.strokeStyle = 'rgba(212, 175, 55, 0.2)';
                this.ctx.lineWidth = 1;
                
                this.ctx.beginPath();
                this.ctx.moveTo(15, 100);
                this.ctx.lineTo(15, 300);
                this.ctx.stroke();
                
                this.ctx.beginPath();
                this.ctx.moveTo(this.width - 15, 100);
                this.ctx.lineTo(this.width - 15, 300);
                this.ctx.stroke();
            }
        };

        // ===== INPUT HANDLING =====
        const keys = {};
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            e.preventDefault();
        });
        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
            e.preventDefault();
        });

        function updatePaddleInput() {
            // Left paddle (always controlled by player in single/multi)
            if (keys['w'] || keys['W']) pong.paddles.left.vy = -pong.paddles.left.speed;
            else if (keys['s'] || keys['S']) pong.paddles.left.vy = pong.paddles.left.speed;
            else pong.paddles.left.vy = 0;

            // Right paddle - controlled by player in multiplayer, AI in single player
            if (gameState.gameMode === 'multi') {
                if (keys['ArrowUp']) pong.paddles.right.vy = -pong.paddles.right.speed;
                else if (keys['ArrowDown']) pong.paddles.right.vy = pong.paddles.right.speed;
                else pong.paddles.right.vy = 0;
            }
        }

        // ===== GAME LOOP =====
        function gameLoop() {
            if (gameState.gameStartTime) {
                gameState.elapsedSeconds = Math.floor((Date.now() - gameState.gameStartTime) / 1000);
                
                const minutes = Math.floor(gameState.elapsedSeconds / 60);
                const seconds = gameState.elapsedSeconds % 60;
                
                let instructions = '';
                if (gameState.gameMode === 'single') {
                    instructions = `${minutes}:${seconds.toString().padStart(2, '0')} ‚Ä¢ Use W/S to move your paddle`;
                } else {
                    instructions = `${minutes}:${seconds.toString().padStart(2, '0')} ‚Ä¢ Left: W/S | Right: UP/DOWN`;
                }
                document.getElementById('gameInfo').textContent = instructions;
            }
            
            if (gameState.isPaused) {
                const pauseElapsed = Date.now() - gameState.pauseStartTime;
                if (pauseElapsed >= 2000) {
                    gameState.isPaused = false;
                    pong.resetBall();
                } else {
                    const ctx = pong.ctx;
                    ctx.fillStyle = '#0a0a0a';
                    ctx.fillRect(0, 0, pong.width, pong.height);

                    ctx.strokeStyle = 'rgba(212, 175, 55, 0.3)';
                    ctx.setLineDash([10, 10]);
                    ctx.beginPath();
                    ctx.moveTo(pong.width / 2, 0);
                    ctx.lineTo(pong.width / 2, pong.height);
                    ctx.stroke();
                    ctx.setLineDash([]);

                    ctx.fillStyle = '#d4af37';
                    ctx.fillRect(pong.paddles.left.x, pong.paddles.left.y, pong.paddles.left.width, pong.paddles.left.height);
                    ctx.fillRect(pong.paddles.right.x, pong.paddles.right.y, pong.paddles.right.width, pong.paddles.right.height);
                    
                    document.getElementById('leftScore').textContent = gameState.leftScore;
                    document.getElementById('rightScore').textContent = gameState.rightScore;
                    
                    ctx.font = 'bold 120px Arial';
                    ctx.fillStyle = 'rgba(212, 175, 55, 0.8)';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('GOAL!', pong.width / 2, pong.height / 2);
                    
                    ctx.font = 'bold 60px Arial';
                    ctx.fillStyle = 'rgba(0, 255, 0, 0.9)';
                    ctx.fillText(`${gameState.leftScore} - ${gameState.rightScore}`, pong.width / 2, pong.height / 2 + 100);
                    
                    requestAnimationFrame(gameLoop);
                    return;
                }
            }
            
            updatePaddleInput();
            
            // Only use AI in single-player mode
            if (gameState.gameMode === 'single') {
                ai.update(pong.ball.x, pong.ball.y, pong.paddles.right.y);
            }
            
            pong.update();
            pong.draw();
            
            document.getElementById('leftScore').textContent = gameState.leftScore;
            document.getElementById('rightScore').textContent = gameState.rightScore;
            
            requestAnimationFrame(gameLoop);
        }

        // ===== UI EVENT LISTENERS =====
        
        // Mode selection buttons
        document.getElementById('singleplayerBtn').addEventListener('click', () => {
            gameState.gameMode = 'single';
            document.getElementById('modeScreen').style.display = 'none';
            document.getElementById('titleScreen').style.display = 'block';
            
            // Update title screen for single player
            document.querySelector('#titleScreen .instructions').innerHTML = `
                <h3>How to Play:</h3>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>Your Paddle (Kush):</strong> W and S keys to move up and down</li>
                    <li><strong>AI Opponent (Egypt):</strong> Computer controls the right paddle</li>
                    <li>Score points by defending your side and hitting the ball back</li>
                    <li>Try to beat the AI and set a high score!</li>
                </ul>
            `;
            document.getElementById('startBtn').textContent = 'Start Game';
        });

        document.getElementById('multiplayerBtn').addEventListener('click', () => {
            gameState.gameMode = 'multi';
            document.getElementById('modeScreen').style.display = 'none';
            document.getElementById('titleScreen').style.display = 'block';
            
            // Update title screen for multiplayer
            document.querySelector('#titleScreen .instructions').innerHTML = `
                <h3>How to Play (Two Players):</h3>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>Left Paddle (Kush):</strong> W and S keys to move up and down</li>
                    <li><strong>Right Paddle (Egypt):</strong> UP and DOWN arrow keys to move</li>
                    <li>Score points by defending your side and hitting the ball back</li>
                    <li>Compete with a friend on the same keyboard!</li>
                </ul>
            `;
            document.getElementById('startBtn').textContent = 'Start Game';
        });

        document.getElementById('playerName').addEventListener('input', (e) => {
            document.getElementById('startBtn').disabled = !e.target.value.trim();
        });

        document.getElementById('startBtn').addEventListener('click', () => {
            gameState.playerName = document.getElementById('playerName').value.trim();
            if (!gameState.playerName) {
                document.getElementById('statusText').textContent = 'Please enter your name';
                return;
            }

            gameState.gameStarted = true;
            gameState.gameStartTime = Date.now();
            
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            // Update UI based on game mode
            document.getElementById('playerDisplayName').textContent = gameState.playerName;
            
            if (gameState.gameMode === 'single') {
                document.getElementById('rightPlayerLabel').textContent = 'üèõÔ∏è EGYPT (AI)';
                document.getElementById('rightPlayerName').textContent = 'Computer';
                document.querySelector('.historical-banner').textContent = 'Test your Pong skills against the AI! The ancient kingdoms will judge your prowess.';
            } else {
                document.getElementById('rightPlayerLabel').textContent = 'üèõÔ∏è EGYPT';
                document.getElementById('rightPlayerName').textContent = 'Player 2';
                document.querySelector('.historical-banner').textContent = 'Two players compete for supremacy! W/S vs UP/DOWN - who will claim the Nile Valley?';
            }
            
            document.getElementById('titleScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            pong.init();
            playStartSound();
            gameLoop();
        });

        // Initialize with mode screen on load
        window.addEventListener('load', () => {
            document.getElementById('modeScreen').style.display = 'block';
            document.getElementById('titleScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
        });
    </script>
</body>
</html>
